# 后端API接口库
# 格式: API-[HTTP-Method]-[Resource]
interfaces:
  - type: Backend
    id: API-POST-SendVerificationCode
    route: POST /api/auth/send-verification-code
    description: 发送验证码到指定手机号，生成6位验证码并保存到数据库。
    input:
      type: JSON
      body:
        phoneNumber: string
    output:
      success:
        statusCode: 200
        body: { message: "验证码已发送", expiresIn: 60 }
      error:
        - statusCode: 400
          body: { error: "请输入正确的手机号码" }
    dependencies:
      - DB-SaveVerificationCode
    acceptanceCriteria:
      - 手机号格式正确时，生成6位验证码并打印在控制台。
      - 验证码保存到数据库，有效期60秒。
      - 返回成功响应包含过期时间信息。
    changeLog:
      - date: "2025-01-12"
        description: "初始创建。"

  - type: Backend
    id: API-POST-Login
    route: POST /api/auth/login
    description: 处理用户登录请求，验证手机号注册状态和验证码正确性。
    input:
      type: JSON
      body:
        phoneNumber: string
        verificationCode: string
    output:
      success:
        statusCode: 200
        body: { message: "登录成功", userId: "uuid", token: "jwt" }
      error:
        - statusCode: 400
          body: { error: "该手机号未注册，请先完成注册" }
        - statusCode: 401
          body: { error: "验证码错误" }
    dependencies:
      - DB-FindUserByPhone
      - DB-VerifyCode
    acceptanceCriteria:
      - 手机号未注册时，返回400错误。
      - 验证码错误时，返回401错误。
      - 验证成功时，返回用户ID和JWT令牌。
    changeLog:
      - date: "2025-01-12"
        description: "初始创建。"

  - type: Backend
    id: API-POST-Register
    route: POST /api/auth/register
    description: 处理用户注册请求，包含验证码校验和用户创建。
    input:
      type: JSON
      body:
        phoneNumber: string
        verificationCode: string
        agreeToTerms: boolean
    output:
      success:
        statusCode: 201
        body: { message: "注册成功", userId: "uuid", token: "jwt" }
      error:
        - statusCode: 400
          body: { error: "验证码错误" }
        - statusCode: 409
          body: { error: "该手机号已注册，将直接为您登录", userId: "uuid", token: "jwt" }
    dependencies:
      - DB-FindUserByPhone
      - DB-VerifyCode
      - DB-CreateUser
    acceptanceCriteria:
      - 手机号已注册时，返回409状态并直接登录。
      - 验证码错误时，返回400错误。
      - 注册成功时，创建用户并返回用户ID和JWT令牌。
    changeLog:
      - date: "2025-01-12"
        description: "初始创建。"